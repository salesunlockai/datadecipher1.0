@model DataDecipher.WebApp.Models.Method
@{
    ViewData["Title"] = "Main Page";
    Layout = "_MainLayout";
}
<br />

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<link href="https://cdn.quilljs.com/1.1.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.1.6/quill.js"></script>

<div class="container-fluid">
    <h5>Welcome to Data Decipher</h5>
    <p>Use instructions below to quickly obtain insights from your data and generate reports</p>
</div>
<div id="method" class="container-fluid">
    <div class="row>">
        <div class="col-md-4">
            <h6>1. Define your method</h6>
            <br />
        </div>
    </div>
    @await Html.PartialAsync("~/Views/Method/_NewMethod.cshtml")
</div>
<div id="datasource" class="section">
    <div class="container-fluid">
        <div class="row>">
            <div class=col-md-4>
                <h6>2. Set datasource</h6>
                <br />
                <br />
            </div>
        </div>
        <div class="row>">
            <div class=col-md-6>
                <p>Select files from your computer</p>
                <form action="" method="post" enctype="multipart/form-data" id="js-upload-form">
                    <div class="form-inline">
                        <div class="form-group">
                            <input type="file" class="file btn btn-primary btn-simple" name="files[]" id="js-upload-files" multiple>
                        </div>
                        <button type="submit" class="btn btn-primary btn-round" id="js-upload-submit">Upload files</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="row>">
            <div class=col-md-4>
                <br />
                <p>Or drag and drop files below</p>
                <div class="upload-drop-zone" id="drop-zone">
                    Just drag and drop files here
                </div>
            </div>
        </div>
        <div class="row>">
            <div class=col-md-4>
                <br />
                <p>Or Select from existing datasources</p>
                @*@await Html.PartialAsync("~/Views/DataSource/_ListDataSource.cshtml",Model)*@
            </div>
        </div>
    </div>
</div>
<div id="instrument" class="section">
    <div class="container-fluid">
        <div class="row>">
            <div class=col-md-4>
                <h6>3. Set instrument configuration</h6>
                <br />
                <label for="fileList">File: </label>
                <select id="fileList" onChange="storeRawFileSelection(this);">
                    <option value="0">Select a file...</option>
                    <option value="1">TestData/Raw/Sample.csv</option>
                    <option value="2">TestData/Raw/Sample.xml</option>
                    <option value="3">TestData/Raw/Sample.txt</option>
                    <option value="4">TestData/Raw/Sample.dat</option>
                </select>
                <input type="text" id="inputSelectedFile" hidden />
                <input type="button" id="showRawData" value="Show Raw Data" class="btn btn-primary btn-round" />
                <br />
                <div id="divRawDataContainer">
                </div>
            </div>
        </div>
    </div>
</div>
<div id="parser" class="section">
    <div class="container-fluid">
        <div class="row>">
            <div class=col-md-4>
                <h6>4. Set parser configuration</h6>
                <br />
                <div id="parsingRules">
                </div>
                <br />
            </div>
        </div>
    </div>
</div>
<div id="report" class="section">
    <div class="container-fluid">
        <div class="row>">
            <div class=col-md-4>
                <h6>5. Set reporting configuration</h6>
                <br />
                <div id="divParsedDataContainer">
                </div>
                <br />
                <input type="file" id="btnDataExtract" value="Create Data Extract" onclick="saveParsedDataAsExtract()" class="btn btn-primary" />
                <input type="button" id="btnStoreDatabase" value="Store in Database" class="btn btn-primary" disabled="true" />
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">function storeRawFileSelection(sel) {
    $('#inputSelectedFile').val(sel.options[sel.selectedIndex].text);
    fullFilePath = sel.options[sel.selectedIndex].text;
    fileExtension = fullFilePath.replace(/^.*\./, '');
    switch (fileExtension) {
            case 'txt': case 'dat':
                $.ajax({
                    url: '/Main/DisplayParsingViewTxtDat',
                    type: 'POST',
                    datatype: 'text',
                    contentType: 'application/x-www-form-urlencoded',
                    data: { filePath: fullFilePath },
                    success: function(content) {
                        $('#parsingRules').html(content);
                    },
                error: function(e) { }
                });
                break;
            case 'csv':
                $.ajax({
                    url: '/Main/DisplayParsingViewCsv',
                    type: 'POST',
                    datatype: 'text',
                    contentType: 'application/x-www-form-urlencoded',
                    data: { filePath: fullFilePath },
                    success: function(content) {
                        $('#parsingRules').html(content);
                    },
                error: function(e) { }
                });
                break;
            case 'xml':
                $.ajax({
                    url: '/Main/DisplayParsingViewXml',
                    type: 'POST',
                    datatype: 'text',
                    contentType: 'application/x-www-form-urlencoded',
                    data: { filePath: fullFilePath },
                    success: function(content) {
                        $('#parsingRules').html(content);
                    },
                error: function(e) { }
                });
                break;
            default:
                x.innerhtml = 'none';
        }
}

$(document).ready(function() {
    $('#showRawData').click(function() {
        $.ajax({
            url: '/Main/DisplayRawData',
            type: 'POST',
            datatype: 'text',
            contentType: 'application/x-www-form-urlencoded',
            data: { inputSelectedFile: $('#inputSelectedFile').val() },
            success: function(content) {
                $('#divRawDataContainer').html(content);
            },
            error: function(e) { }
        });
    });
});

function saveParsedDataAsExtract(){
}

</script>

